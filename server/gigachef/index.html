<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

  <title>Gigachef | Gigamunch</title>

  <base href="/gigachef/">

  <meta name="theme-color" content="#FF7043">
  <link rel="manifest" href="manifest.json">

  <script>

    // setup Polymer options
    window.Polymer = {lazyRegister: true, dom: 'shadow'};

    // load webcomponents polyfills
    (function() {
      if ('registerElement' in document
          && 'import' in document.createElement('link')
          && 'content' in document.createElement('template')) {
        // browser has web components
      } else {
        // polyfill web components
        var e = document.createElement('script');
        e.src = 'bower_components/webcomponentsjs/webcomponents-lite.min.js';
        document.head.appendChild(e);
      }
    })();

    // load pre-caching service worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('service-worker.js');
      });
    }

    // Set Environment
    var CHEF = CHEF || {};
    CHEF.isDev = false;
    CHEF.isStage = false;
    CHEF.isProd = false;
    CHEF.DEV = 'dev';
    CHEF.STAGE = 'stage';
    CHEF.PROD = 'prod';
    switch (location.hostname) {
      case 'localhost':
        CHEF.Env = CHEF.DEV;
        CHEF.isDev = true;
        break;
      case 'gigamunch-omninexus-dev.appspot.com':
        CHEF.Env = CHEF.STAGE;
        CHEF.isStage = true;
        break;
      default:
        CHEF.Env = CHEF.PROD;
        CHEF.isProd = true;
    }
  </script>
  <link rel="import" href="src/my-app.html">

  <style>

    body {
      margin: 0;
      font-family: 'Roboto', 'Noto', sans-serif;
      line-height: 1.5;
      min-height: 100vh;
      background-color: #eee;
    }

  </style>
  <!-- Google Analytics -->
  <script async src="https://www.google-analytics.com/analytics.js"></script>
  <script>
    window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
    ga('create', 'UA-71567908-1', 'auto');
    ga('send', 'pageview');
    // Setup error tracking before anything else runs.
    window.onerror = function(message, file, lineNumber, columnNumber, error) {
      // We don't want to trigger any errors inside window.onerror, so wrap in a try/catch.
      try {
        // Some browsers don't support error param yet.
        if (error !== undefined) {
          message = error.stack;
        }
        ga('send', 'event', 'error', file + ':' + lineNumber, message);
      } catch (e) {
        // no-op
      }
    };
    // End Google Analytics

    // Upgrade browser
    // Code from Google IO 2016
    // Check if browser is supported by web components polyfill.
    // Feature detection isn't sufficient; webcomponentsjs attempts to polyfill
    // missing features, but some browsers are known to not work under it.
    var supported = (function whatBrowserYouBe() {
      var uaString = navigator.userAgent;

      // Sorry IE < 10.
      var msie = /MSIE +([\d\.]+)/.exec(uaString);
      if (msie && msie[1]) {
        if (msie[1] === '7.0') {
          var tridentVersion = /Trident\/(\d.\d)/.exec(uaString);
          if (tridentVersion && tridentVersion[1]) {
            return parseInt(tridentVersion[1], 10) >= 6;
          } else {
            return false;
          }
        } else {
          return parseInt(msie[1], 10) >= 10;
        }
      }
      // Sorry older Android browser.
      if (uaString.indexOf('Chrome') === -1 && uaString.indexOf('Android') !== -1) {
        return !/^Google/.test(navigator.vendor);
      }
      // Sorry Opera < 15.
      if (uaString.indexOf('Opera') !== -1) {
        return false;
      }
      // Everyone else goes through.
      return true;
    })();

    if (!supported) {
      var redirectToUpgradePage = function() {
        window.location = "/upgrade";
      };
      // Sends a pageview here because this code will run before IOWA.Analytics is initialized.
      ga('send', 'pageview');
      ga('send', 'event', 'Polymer', 'unsupported-browser', navigator.userAgent, {
        hitCallback: redirectToUpgradePage
      });
      // Adds a timeout to redirect in the event that analytics.js fails to
      // load or is blocked by a browser extension.
      setTimeout(redirectToUpgradePage, 5000);
    }
  </script>
  <!-- End upgrade browser -->
</head>
<body>
  <script src="js/user.js"></script>
  <script src="js/service.js"></script>
  <script src="https://apis.google.com/js/client.js?onload=initService"></script>

  <my-app id="app" base-url="/gigachef"></my-app>

  <script>
    var app = document.querySelector('#app');
  </script>
  <link rel="stylesheet" href="/common/common.css">
</body>
</html>
