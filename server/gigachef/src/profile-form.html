<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../bower_components/gold-email-input/gold-email-input.html">
<link rel="import" href="../bower_components/gold-phone-input/gold-phone-input.html">
<link rel="import" href="../bower_components/gold-zip-input/gold-zip-input.html">

<link rel="import" href="select-with-options.html">
<link rel="import" href="paper-select.html">
<link rel="import" href="file-input.html">
<link rel="import" href="placeholder-img.html">

<dom-module id="profile-form">
  <template>
    <style include="paper-select">
      :host {
        display: block;
        padding: 15px;
      }

      #submitButton {
        width: 100%;
        margin: 20px 0px;
      }
      .row {
        display: flex;
        flex-direction: row;
        align-items: flex-end;
      }
      .row > *:not(:first-child) {
        margin-left: 8px;
      }
      .select-input {
        display: flex;
        flex-direction: column;
      }

      .flex-1 {
        flex: 1;
      }

      label {
        line-height: 20px;
      }

      .profile-pic, placeholder-img {
        height: 200px;
        width: 200px;
        border-radius: 50%;
        margin: auto;
        cursor: pointer;
      }

      .profile-top {
        position: relative;
        bottom: 125px;
        color: white;
        text-align: center;
      }
    </style>

    <form
      is="iron-form"
      id="form"
      method="post"
      action="#"
      on-change="updateSubmitButtonState">
      <file-input
        photos="{{photos}}"
        url-postfix="=s720-c">
        <div class="profile-pic">
          <placeholder-img
            icon="account-circle"
            alt="user profile picture"
            src="[[gigachef.photo_url]]">
          </placeholder-img>
          <div class="profile-top">
            <iron-icon icon="add-a-photo">
            </iron-icon>
            <br>
            <span>Change profile photo</span>
          </div>
        </div>
      </file-input>
      <paper-input label="Name" value="{{gigachef.name}}" required auto-validate></paper-input>
      <gold-email-input label="Email" value="{{gigachef.email}}" required auto-validate></gold-email-input>
      <gold-phone-input label="Phone Number" value="{{gigachef.phone_number}}" required auto-validate></gold-phone-input>
      <paper-input label="Apt #" value="{{gigachef.address.apt}}" auto-validate></paper-input>
      <paper-input label="Street" value="{{gigachef.address.street}}" required auto-validate></paper-input>
      <paper-input label="City" value="{{gigachef.address.city}}" required auto-validate></paper-input>
      <!-- group states and zip -->
      <div class="row">
        <div class="select-input flex-1">
        <label>State</label>
        <paper-select>
          <select is="select-with-options" option-value="value" value="{{gigachef.address.state::change}}" required>
            <option value="AL">AL</option>
            <option value="AK">AK</option>
            <option value="AZ">AZ</option>
            <option value="AR">AR</option>
            <option value="CA">CA</option>
            <option value="CO">CO</option>
            <option value="CT">CT</option>
            <option value="DE">DE</option>
            <option value="DC">DC</option>
            <option value="FL">FL</option>
            <option value="GA">GA</option>
            <option value="HI">HI</option>
            <option value="ID">ID</option>
            <option value="IL">IL</option>
            <option value="IN">IN</option>
            <option value="IA">IA</option>
            <option value="KS">KS</option>
            <option value="KY">KY</option>
            <option value="LA">LA</option>
            <option value="ME">ME</option>
            <option value="MD">MD</option>
            <option value="MA">MA</option>
            <option value="MI">MI</option>
            <option value="MN">MN</option>
            <option value="MS">MS</option>
            <option value="MO">MO</option>
            <option value="MT">MT</option>
            <option value="NE">NE</option>
            <option value="NV">NV</option>
            <option value="NH">NH</option>
            <option value="NJ">NJ</option>
            <option value="NM">NM</option>
            <option value="NY">NY</option>
            <option value="NC">NC</option>
            <option value="ND">ND</option>
            <option value="OH">OH</option>
            <option value="OK">OK</option>
            <option value="OR">OR</option>
            <option value="PA">PA</option>
            <option value="RI">RI</option>
            <option value="SC">SC</option>
            <option value="SD">SD</option>
            <option value="TN">TN</option>
            <option value="TX">TX</option>
            <option value="UT">UT</option>
            <option value="VT">VT</option>
            <option value="VA">VA</option>
            <option value="WA">WA</option>
            <option value="WV">WV</option>
            <option value="WI">WI</option>
            <option value="WY">WY</option>
          </select>
          <paper-md-decorator>
            <paper-underline></paper-underline>
          </paper-md-decorator>
        </paper-select>
        </div>
        <gold-zip-input class="flex-1" label="Zip" value="{{gigachef.address.zip}}" required auto-validate></gold-zip-input>
      </div>

      <paper-checkbox id="agreeCheckbox" required>I agree to the <a href="/terms">Terms &amp; Agreement</a> and <a href="privacy">Privacy Policy</a></paper-checkbox>

      <paper-button
        id="submitButton"
        on-tap="submit"
        raised
        disabled>
        <paper-spinner id="spinner" hidden></paper-spinner>Update
      </paper-button>
    </form>

  </template>
  <script>
    'use strict';

    Polymer({
      is: 'profile-form',

      properties: {
        gigachef: {
          type: Object,
          notify: true,
          reflectToAttribute: true,
          value: {
            address: {
              zip: '',
            },
          },
        },
        service: {
          type: Object,
        },
        user: {
          type: Object,
        },
        photos: {
          type: Array,
          observer: 'photosChanged',
        },
      },
      selected: function () {
        this.$.spinner.hidden = true;
        this.$.spinner.active = false;
        this.getGigachef(this.user.id);
      },
      getGigachef: function (id) {
        this.service.getGigachef(function (chef, err) {
          if (err.code !== 0) {
            var d = {
              error: err,
              options: [{
                text: 'Try Again',
                func: function () {
                  this.getGigachef(id);
                }.bind(this)
              }],
            };
            this.fire('error', d);
          }
          this.set('gigachef', chef);
        }.bind(this));
      },
      submit: function (){
        this.$.spinner.hidden = false;
        this.$.spinner.active = true;
        this.$.submitButton.disabled = true;
        this.updateProfile(this.gigachef);
      },
      updateProfile: function (gigachef) {
        this.service.updateProfile(gigachef, function(chef, err){
          if (err.code !== 0) {
            var d = {
              error: err,
              options: [{
                text: 'Try Again',
                func: function() {
                        this.saveItem(item);
                      }.bind(this)
                }],
            };
            this.fire('error', d);
          } else {
            this.set('gigachef', chef);
            this.fire('updated', { gigachef: chef });
          }
        }.bind(this));
      },
      updateSubmitButtonState: function () {
        var form = this.$.form;
        var submitButton = this.$.submitButton;
        // Validate the entire form to see if we should enable the `Submit` button.
        submitButton.disabled = !form.validate();
      },
      photosChanged: function(photos) {
        if (photos.length > 0) {
          this.set('gigachef.photo_url', photos[0]);
          this.set(photos, []);
        }
      },
    });
  </script>
</dom-module>
