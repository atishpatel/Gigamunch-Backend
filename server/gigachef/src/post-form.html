<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">

<link rel="import" href="datetime-input.html">
<link rel="import" href="item-fields.html">

<dom-module id="post-form">
  <template>
    <style>
      :host {
        display: block;
      }
      #submitButton {
        width: 100%;
        margin: 20px 0px;
      }
    </style>

    <form
      is="iron-form"
      id="form"
      method="post"
      action="#"
      on-change="_updateSubmitButtonState">
      <item-fields
        id="itemFields"
        photos="{{post.photos}}"
        title="{{post.title}}"
        description="{{post.description}}"
        ingredients="{{post.ingredients}}"
        general-tags="{{post.general_tags}}"
        dietary-needs-tags="{{post.dietary_needs_tags}}">
      </item-fields>
      <paper-input
        label="Number of Servings Offered"
        value="{{_servings_offered}}"
        type="number"
        required
        auto-validate>
      </paper-input>
      <paper-input
        label="Price per serving"
        value="{{_price_per_serving}}"
        type="number"
        required
        auto-validate>
        <div prefix>$&nbsp;</div>
      </paper-input>
      <datetime-input id="closeTime" label="Post close time"
                      epoch="{{post.closing_datetime}}">
      </datetime-input>
      <template is="dom-if" if$="[[!post.is_order_now]]" restamp="true">
        <datetime-input id="readyTime" label="Meal ready time"
                        epoch="{{post.ready_datetime}}">
        </datetime-input>
      </template>
      <paper-button
        id="submitButton"
        on-tap="_submit"
        raised
        disabled>
        <paper-spinner id="spinner" hidden></paper-spinner>Save
      </paper-button>
    </form>

  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'post-form',

      properties: {
        post: {
          type: Object,
          notify: true,
          value: {}
        }
      },
      update: function() {
        this.$.spinner.hidden = true;
        this.$.spinner.active = false;
        this.$.itemFields.update();
      },
      _submit: function(){
        this.$.spinner.hidden = false;
        this.$.spinner.active = true;
        this.$.submitButton.disabled = true;
        this.fire('post', {post: this.item})
      },
      _updateSubmitButtonState: function() {
        var form = this.$.form;
        var submitButton = this.$.submitButton;
        // Validate the entire form to see if we should enable the `Submit` button.
        submitButton.disabled = !form.validate();
      }
    });
  })();
  </script>
</dom-module>
