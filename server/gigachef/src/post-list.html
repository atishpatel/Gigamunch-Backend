<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/paper-material/paper-material.html">

<link rel="import" href="app-icons.html">
<link rel="import" href="like-icon.html">
<link rel="import" href="post-card.html">

<dom-module id="post-list">
  <template>
    <style>
      :host {
        display: block;
      }

      paper-material {
        background: white;
        padding: 10px;
      }

      paper-material h1 {
        font-size: 1.25em;
        font-weight: 500;
      }

      hr {
        border: none;
        margin: 0;
        background-color: var(--secondary-text-color);
        height: 1px;
      }

      .grid {
        padding: 15px;
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: space-between;
      }

      .post-divider {
        padding: 15px;
        color: var(--secondary-text-color);
      }

      .post-divider-text {
        padding: 0 0 8px 1%;
      }

      strong {
        font-weight: 400;
      }

      .row {
        display: flex;
        flex-direction: row;
      }

      .column {
        display: flex;
        flex-direction: column;
        flex: 1;
      }

      .flex-2 {
        flex: 2;
      }

      .center-text {
        text-align: center;
        justify-content: center;
      }

      @media (min-width: 767px) {
        post-card, paper-material {
          flex-basis: 45%;
          max-width: 44%;
          margin: 1%;
        }
      }
    </style>

    <div class="grid">
      <template is="dom-repeat" items="{{posts}}" as="post" filter="isOpenPost" sort="sortByCloseTime">
        <post-card post="[[post]]"></post-card>
      </template>

      <template is="dom-if" if="[[showTutorialCard]]">
        <paper-material>
          <h1>Tutorial Card</h1>
          <p>
            My Orders is where you can see all your posts and the number of servings each person ordered. 
            <br><br>
            Post a dish from <a href="../items">My Kitchen</a> to start building your brand and earn money cooking! :)
          </p>
        </paper-card>
      </template>
    </div>
    <div class="post-divider">
      <div class="post-divider-text">Closed Posts</div>
      <hr>
    </div>
    <div class="grid">
      <template is="dom-repeat" items="{{posts}}" as="post" filter="isClosedPost" sort="sortByCloseTime">
        <post-card post="[[post]]"></post-card>
      </template>
    </div>

  </template>
  <script>
    'use strict';

    Polymer({
      is: 'post-list',

      properties: {
        posts: {
          type: Array,
          notify: true,
          reflectToAttribute: true,
          value: [],
        },
        service: {
          type: Object,
        },
        showTutorialCard: {
          type: Boolean,
          value: false,
        },
      },
      selected: function() {
        this.getPosts();
      },
      getPosts: function() {
        this.service.getPosts(0, 200, function (posts, err) {
          if (err.code !== 0) {
            this.fire('error', {
              error: err,
              options: [{
                text: 'Try Again',
                func: this.getItems.bind(this),
              }],
            });
          }
          if (posts === undefined || posts === null || posts.length < 2) {
            this.set('showTutorialCard', true);
          } else {
            this.set('showTutorialCard', false);
          }
          this.set('posts', posts);
        }.bind(this));
      },
      isOpenPost: function(post) {
        var now = new Date();
        var closeDate = new Date(post.closing_datetime * 1000);
        return closeDate >= now
      },
      isClosedPost: function(post) {
        return !this.isOpenPost(post);
      },
      sortByCloseTime: function(p1, p2) {
        return p1.closing_datetime < p2.closing_datetime ? -1 : 1;
      },
    });
  </script>
</dom-module>
