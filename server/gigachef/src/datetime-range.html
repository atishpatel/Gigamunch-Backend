<!--

-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">

<link rel="import" href="app-icons.html">
<link rel="import" href="select-with-options.html">
<link rel="import" href="paper-select.html">

<dom-module id="datetime-range">
  <template>
    <style include="paper-select">
      :host {
        display: block;
        padding-top: 10px;

        --paper-button: {
          background: white;
          color: var(--primary-color);
        };
      }

      .divider {
        flex: .05;
      }

      .flex-layout {
        display: flex;
      }

      .flex-column {
        display: flex;
        flex-direction: column;
      }

      .flex {
        flex: 1;
      }

      .half-field {
        width: 48.5%;
      }

      label {
        font-size: 12px;
        color: #727272;
        -webkit-font-smoothing: antialiased;
      }
    </style>
    <label>[[label]]</label>
    <div class="flex-layout">
      <paper-select class="half-field">
        <select id="dates" is="select-with-options" option-value="value" value="{{date::change}}" required>
          <!-- dynamically generated -->
        </select>
        <paper-md-decorator>
          <paper-underline></paper-underline>
        </paper-md-decorator>
      </paper-select>
    </div>
    <div class="flex-layout">
      <div class="flex-column flex">
        <label>From</label>
        <paper-select>
          <select id="startTime" is="select-with-options" option-value="value" value="{{starttime::change}}" required>
            <option value="06:00">06:00 AM</option>
            <option value="06:30">06:30 AM</option>
            <option value="07:00">07:00 AM</option>
            <option value="07:30">07:30 AM</option>
            <option value="08:00">08:00 AM</option>
            <option value="08:30">08:30 AM</option>
            <option value="09:00">09:00 AM</option>
            <option value="09:30">09:30 AM</option>
            <option value="10:00">10:00 AM</option>
            <option value="10:30">10:30 AM</option>
            <option value="11:00">11:00 AM</option>
            <option value="11:30">11:30 AM</option>
            <option value="12:00">12:00 PM (noon)</option>
            <option value="12:30">12:30 PM</option>
            <option value="13:00">01:00 PM</option>
            <option value="13:30">01:30 PM</option>
            <option value="14:00">02:00 PM</option>
            <option value="14:30">02:30 PM</option>
            <option value="15:00">03:00 PM</option>
            <option value="15:30">03:30 PM</option>
            <option value="16:00">04:00 PM</option>
            <option value="16:30">04:30 PM</option>
            <option value="17:00">05:00 PM</option>
            <option value="17:30">05:30 PM</option>
            <option value="18:00">06:00 PM</option>
            <option value="18:30">06:30 PM</option>
            <option value="19:00">07:00 PM</option>
            <option value="19:30">07:30 PM</option>
            <option value="20:00">08:00 PM</option>
            <option value="20:30">08:30 PM</option>
            <option value="21:00">09:00 PM</option>
            <option value="21:30">09:30 PM</option>
            <option value="22:00">10:00 PM</option>
            <option value="22:30">10:30 PM</option>
            <option value="23:00">11:00 PM</option>
            <option value="23:30">11:30 PM</option>
            <option value="00:00">12:00 AM (midnight)</option>
            <option value="00:30">12:30 AM</option>
            <option value="01:00">01:00 AM</option>
            <option value="01:30">01:30 AM</option>
            <option value="02:00">02:00 AM</option>
            <option value="02:30">02:30 AM</option>
            <option value="03:00">03:00 AM</option>
            <option value="03:30">03:30 AM</option>
            <option value="04:00">04:00 AM</option>
            <option value="04:30">04:30 AM</option>
            <option value="05:00">05:00 AM</option>
            <option value="05:30">05:30 AM</option>
          </select>
          <paper-md-decorator>
            <paper-underline></paper-underline>
          </paper-md-decorator>
        </paper-select>
      </div>
      <span class="divider"></span>
      <div class="flex-column flex">
        <label>To</label>
        <paper-select>
          <select id="endTime" is="select-with-options" option-value="value" value="{{endtime::change}}" required>
            <option value="06:00">06:00 AM</option>
            <option value="06:30">06:30 AM</option>
            <option value="07:00">07:00 AM</option>
            <option value="07:30">07:30 AM</option>
            <option value="08:00">08:00 AM</option>
            <option value="08:30">08:30 AM</option>
            <option value="09:00">09:00 AM</option>
            <option value="09:30">09:30 AM</option>
            <option value="10:00">10:00 AM</option>
            <option value="10:30">10:30 AM</option>
            <option value="11:00">11:00 AM</option>
            <option value="11:30">11:30 AM</option>
            <option value="12:00">12:00 PM (noon)</option>
            <option value="12:30">12:30 PM</option>
            <option value="13:00">01:00 PM</option>
            <option value="13:30">01:30 PM</option>
            <option value="14:00">02:00 PM</option>
            <option value="14:30">02:30 PM</option>
            <option value="15:00">03:00 PM</option>
            <option value="15:30">03:30 PM</option>
            <option value="16:00">04:00 PM</option>
            <option value="16:30">04:30 PM</option>
            <option value="17:00">05:00 PM</option>
            <option value="17:30">05:30 PM</option>
            <option value="18:00">06:00 PM</option>
            <option value="18:30">06:30 PM</option>
            <option value="19:00">07:00 PM</option>
            <option value="19:30">07:30 PM</option>
            <option value="20:00">08:00 PM</option>
            <option value="20:30">08:30 PM</option>
            <option value="21:00">09:00 PM</option>
            <option value="21:30">09:30 PM</option>
            <option value="22:00">10:00 PM</option>
            <option value="22:30">10:30 PM</option>
            <option value="23:00">11:00 PM</option>
            <option value="23:30">11:30 PM</option>
            <option value="00:00">12:00 AM (midnight)</option>
            <option value="00:30">12:30 AM</option>
            <option value="01:00">01:00 AM</option>
            <option value="01:30">01:30 AM</option>
            <option value="02:00">02:00 AM</option>
            <option value="02:30">02:30 AM</option>
            <option value="03:00">03:00 AM</option>
            <option value="03:30">03:30 AM</option>
            <option value="04:00">04:00 AM</option>
            <option value="04:30">04:30 AM</option>
            <option value="05:00">05:00 AM</option>
            <option value="05:30">05:30 AM</option>
          </select>
          <paper-md-decorator>
            <paper-underline></paper-underline>
          </paper-md-decorator>
        </paper-select>
      </div>
    </div>
  </template>
  <script>
    'use strict';

    Polymer({
      is: 'datetime-range',

      properties: {
        label: {
          type: String,
          notify: true,
          value: 'Pick a date',
        },
        startepoch: {
          type: Number,
          notify: true,
          reflectToAttribute: true,
        },
        date: {
          type: String,
          notify: true,
          observer: 'updateEpoch',
        },
        starttime: {
          type: String,
          notify: true,
          observer: 'updateEpoch',
          value: '12:00',
        },
        endepoch: {
          type: Number,
          notify: true,
          reflectToAttribute: true,
        },
        endtime: {
          type: String,
          notify: true,
          observer: 'updateEpoch',
          value: '14:00',
        },
      },
      ready: function() {
        // add dynamically generated dates
        var today = new Date();
        this.date = today.toDateString();
        var year = today.getFullYear();
        var month = today.getMonth();
        var date = today.getDate();
        for(var i=0; i<30; i++){
          var day = new Date(year, month, date + i);
          var opt = document.createElement("option");
          opt.innerHTML = day.toLocaleDateString();
          opt.value = day.toDateString();
          this.$.dates.appendChild(opt);
        }
      },
      update: function () {
        if (this.startepoch === undefined || this.startepoch === null || this.startepoch === 0) {
          this.updateEpoch();
          return;
        }
        var startdate = new Date(this.startepoch * 1000);
        this.$.dates.value = startdate.toDateString();
        this.$.startTimes.value = startdate.toTimeString().substr(0,5);
        this.starttime = startdate.toTimeString().substr(0,5);
        if (this.endepoch <= this.startepoch) {
          this.endepoch = this.startepoch + 7200;
        }
        var enddate = new Date(this.endepoch * 1000);
        this.$.endTimes.value = enddate.toTimeString().substr(0,5);
        this.endtime = enddate.toTimeString().substr(0,5);
        this.set('date', startdate.toDateString());
      },
      setEpoch: function(startDate, endDate) {
        if (startDate !== undefined && startDate !== null) {
          this.set('startepoch', Math.round(startDate.getTime() / 1000));
        }
        if (endDate !== undefined && endDate !== null) {
          this.set('endepoch', Math.round(endDate.getTime() / 1000));
        }
        this.fire('changed');
      },
      updateEpoch: function () {
        var startDate = new Date(this.date + ' ' + this.starttime);
        var endDate = new Date(this.date + ' ' + this.endtime);
        if (endDate <= startDate) {
          // set end time to the next day
          endDate.setDate(endDate.getDate() + 1);
        }
        this.setEpoch(startDate, endDate);
      },
    });
  </script>
</dom-module>
