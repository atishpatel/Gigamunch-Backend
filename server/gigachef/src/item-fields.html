<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="file-input.html">

<dom-module id="item-fields">
  <template>
    <style>
      :host {
        display: block;
      }

      .add-image {
        text-align: center;
        border-style: dashed;
        border-color: black;
        cursor: pointer;
      }

      .photo {
        position: relative;
      }

      .photo img {
          width: 100%;
      }

      .photo paper-icon-button {
        position: absolute;
        top: 15px;
        right: 15px;
        --paper-icon-button: {
          background-color: gray;
          color: white;
          border-radius: 50%;
        }
      }
    </style>
    <template id="photos" is="dom-repeat" items="{{photos}}" as="photo">
      <div class="photo">
        <paper-icon-button icon="close" on-tap="removePhoto"></paper-icon-button>
        <img src="{{photo}}" alt="food photo"/>
      </div>
    </template>
    <file-input
      photos="{{photos}}"
      url-postfix="=s1080"
      auto-validate>
      <div class="add-image">
        <paper-icon-button icon="add-a-photo"></paper-icon-button>
        Add Image
      </div>
    </file-input>

    <paper-input label="Title"
                 value="{{title}}"
                 required
                 auto-validate></paper-input>
    <paper-input label="Description"
                 value="{{description}}"
                 required
                 auto-validate></paper-input>
    <paper-input label="Ingredients"
                 placeholder="tomatos,onions,..."
                 value="{{_ingredients}}"
                 required
                 auto-validate></paper-input>
    <paper-input label="General Tags"
                 value="{{_general_tags}}"
                 required
                 auto-validate></paper-input>
    <!-- TODO: switch to a checklist for dietary needs -->
    <paper-input label="Dietary Needs Tags"
                 placeholder="vegetarian,no-nuts,..."
                 value="{{_dietary_needs_tags}}"
                 auto-validate></paper-input>

  </template>
  <script>
    'use strict';

    Polymer({
      is: 'item-fields',

      properties: {
        photos: {
          type: Array,
          notify: true,
          reflectToAttribute: true,
          value: [],
        },
        title: {
          type: String,
          notify: true,
          reflectToAttribute: true,
        },
        description: {
          type: String,
          notify: true,
          reflectToAttribute: true,
        },
        ingredients: {
          type: Array,
          notify: true,
          reflectToAttribute: true,
          value: [],
        },
        generalTags: {
          type: Array,
          notify: true,
          reflectToAttribute: true,
          value: [],
        },
        dietaryNeedsTags: {
          type: Array,
          notify: true,
          reflectToAttribute: true,
          value: [],
        },
        _ingredients: {
          type: String,
          observer: '_updateIngredients',
        },
        _general_tags: {
          type: String,
          observer: '_updateGeneralTags',
        },
        _dietary_needs_tags: {
          type: String,
          observer: '_updateDietaryNeedsTags',
        },
      },
      update: function() {
        if (this.ingredients !== undefined) {
          this.set('_ingredients', this.ingredients.toString().replace(',', ', '));
        } else {
          this.set('_ingredients', '');
        }
        if (this.generalTags !== undefined) {
          this.set('_general_tags', this.generalTags.toString().replace(',', ', '));
        } else {
          this.set('_general_tags', '');
        }
        if (this.dietaryNeedsTags !== undefined) {
          this.set('_dietary_needs_tags', this.dietaryNeedsTags.toString().replace(',', ', '));
        } else {
          this.set('_dietary_needs_tags', '');
        }
      },
      _updateIngredients: function(ing) {
        this.ingredients = ing.split(/\s*,\s*/);
      },
      _updateGeneralTags: function(gt) {
        this.generalTags = gt.split(/\s*,\s*/);
      },
      _updateDietaryNeedsTags: function(dnt) {
        this.dietaryNeedsTags = dnt.split(/\s*,\s*/);
      },
      removePhoto: function(e) {
        var index = this.photos.indexOf(e.model.photo);
        this.splice('photos', index, 1);
      },
    });
  </script>
</dom-module>
