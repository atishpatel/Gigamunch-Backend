<!--

-->

<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-time-picker/paper-time-picker.html">
<link rel="import" href="../bower_components/paper-date-picker/paper-date-picker.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">

<link rel="import" href="my-icons.html">


<dom-module id="datetime-input">
  <template>
    <style include="paper-time-picker-dialog-style">
      :host {
        display: block;
        padding-top: 10px;

        --paper-button: {
          background: white;
          color: var(--primary-color);
        }
      }

      .divider {
        flex: .05;
      }

      label {
        font-size: 12px;
        color: #727272;
        -webkit-font-smoothing: antialiased;
      }
      paper-input {
        margin-top: -20px;
      }

    .paper-date-picker-dialog {
      margin: 0;
      max-height: 520px !important;
      overflow: hidden;
     }
     .paper-date-picker-dialog > paper-date-picker {
       --paper-calendar: {
         padding-bottom: 0;
       };
       margin-top: 0 !important;
       padding: 0;
     }

     .paper-date-picker-dialog > paper-date-picker:not([narrow]) {
       --paper-date-picker-heading: {
         margin-bottom: -62px;
       };
     }

     .paper-time-picker-dialog {
        margin: 0;
        max-height: 520px !important;
      }
      .paper-time-picker-dialog > paper-time-picker {
        --paper-calendar: {
          padding-bottom: 0;
        };
        margin-top: 0 !important;
        padding: 0;
      }

      .paper-time-picker-dialog > paper-time-picker:not([narrow]) {
        --paper-time-picker-heading: {
          margin-bottom: -56px;
        };
      }

    </style>
    <label>[[label]]</label>
    <div class="layout horizontal">
      <paper-input class="flex" id="dateInput" on-tap="_showDatePicker" value="{{_date}}" placeholder="mm/dd/yyyy">
        <iron-icon icon="gigaicons:insert-invitation" suffix></iron-icon>
      </paper-input>
      <span class="divider">
      </span>
      <paper-input id="timeInput" class="flex" on-tap="_showTimePicker" value="{{_time}}" placeholder="hh:mm am/pm">
        <iron-icon icon="gigaicons:access-time" suffix></iron-icon>
      </paper-input>
    </div>


    <paper-dialog
      id="datePickerDialog"
      class="paper-date-picker-dialog"
      modal
      on-iron-overlay-closed="_dismissDateDialog">
      <paper-date-picker id="datePicker" date="[[_d]]"></paper-date-picker>
      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm>OK</paper-button>
      </div>
    </paper-dialog>

    <paper-dialog
      id="timePickerDialog"
      modal
      class="paper-time-picker-dialog"
      on-iron-overlay-closed="_dismissTimeDialog">
      <paper-time-picker id="timePicker" time="[[_time]]" animated="false"></paper-time-picker>
      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm>OK</paper-button>
      </div>
    </paper-dialog>

  </template>
  <script>
    'use strict';

    Polymer({
      is: 'datetime-input',

      properties: {
        epoch: {
          type: Number,
          notify: true,
          reflectToAttribute: true,
        },
        label: {
          type: String,
          notify: true,
          value: 'Pick a date',
        },
        _date: {
          type: String,
          notify: true,
        },
        _d: {
          type: Date,
          notify: true,
        },
        _time: {
          type: String,
          notify: true,
          value: '7:00 PM',
        },
      },
      update: function () {
        if (this.epoch === undefined || this.epoch === null || this.epoch === 0) {
          this.setEpoch(new Date());
        }
        var date = new Date(this.epoch * 100);
        this._updateDate(date);
        this.set('_time', date.toLocaleTimeString().replace(/:[0-9][0-9] /, ' '));
      },
      setEpoch: function(d) {
        this.set('epoch', Math.round(d.getTime() / 100))
      },
      _dismissTimeDialog: function (e) {
        if (e.detail.confirmed) {
          var date = new Date(this._date + ' ' + this.$.timePicker.time);
          this.setEpoch(date);
          this.set('_time', date.toLocaleTimeString().replace(/:[0-9][0-9] /,' '));
        }
        this.$.timePicker.view = 'hours';
      },
      _dismissDateDialog: function (e) {
        if (e.detail.confirmed) { // pressed ok
          var date = new Date(this.$.datePicker.date.toLocaleDateString() + ' ' + this._time);
          this.setEpoch(date);
          this._updateDate(date);
        }
      },
      _updateDate: function (d) {
        this.set('_d', d);
        this.set('_date', d.toLocaleDateString());
      },
      _showTimePicker: function () {
        this.$.timePickerDialog.open();
      },
      _showDatePicker: function () {
        this.$.datePickerDialog.open();
      },
    });
  </script>
</dom-module>
