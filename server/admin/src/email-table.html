<link rel="import"
      href="../../cook/bower_components/polymer/polymer-element.html">

<link rel="import"
      href="../../cook/src/shared-styles.html">

<dom-module id="email-table">
  <template>
    <shared-styles>
      <style include="shared-styles">
         :host {
          display: block;
        }

        .table {
          display: table;
          width: 100%;
          border: 1px solid #000;
        }

        .table-header-row {
          background-color: #ccc;
          display: table-header-group;
          font-weight: bold;
        }

        .table-row {
          display: table-row;
          width: auto;
          clear: both;
        }

        .table-cell {
          border: 1px solid #999999;
          padding: 3px 10px;
          display: table-cell;
          flex: 1;
          /*display: flex;*/
          justify-content: space-between;
          align-items: center;
        }

        .table-body {
          display: table-row-group;
        }

      </style>
    </shared-styles>
    <p><strong>Non-Veg Emails:</strong>
      <dom-repeat items="[[nonVegEmails]]"
                  as="email">
        <template>
          [[email]],
        </template>
      </dom-repeat>
    </p>
    <p><strong>Non-veg Names:</strong>
      <dom-repeat items="[[nonVegNames]]"
                  as="name">
        <template>
          [[name]],
        </template>
      </dom-repeat>
    </p>
    <p><strong>Veg Emails:</strong>
      <dom-repeat items="[[vegEmails]]"
                  as="email">
        <template>
          [[email]],
        </template>
      </dom-repeat>
    </p>
    <p><strong>Veg Names:</strong>
      <dom-repeat items="[[vegNames]]"
                  as="name">
        <template>
          [[name]],
        </template>
      </dom-repeat>
    </p>
    <div class="table">
      <div class="table-row table-header-row">
        <div class="table-cell">Email</div>
        <div class="table-cell">First Name</div>
        <div class="table-cell">Last Name</div>
      </div>
      <dom-repeat items="[[sublogs]]"
                  as="sublog">
        <template>
          <div class="table-row">
            <div class="table-cell">[[sublog.sub_email]]</div>
            <div class="table-cell">[[sublog.firstName]]</div>
            <div class="table-cell">[[sublog.lastName]]</div>
          </div>
        </template>
      </dom-repeat>
    </div>
  </template>

  <script>
    class EmailTable extends Polymer.Element {
      static get is() {
        return 'email-table';
      }

      static get properties() {
        return {
          sublogs: {
            type: Array,
            notify: true,
            observer: 'sublogsObserver',
          },
          nonVegEmails: {
            type: Array,
          },
          nonVegNames: {
            type: Array,
          },
          vegEmails: {
            type: Array,
          },
          vegNames: {
            type: Array,
          },
        }
      }

      static get observers() {
        return [ /* observer descriptors */ ]
      }
      constructor() {
        super();
      }
      connectedCallback() {
        super.connectedCallback();
      }

      getStatus(sublog) {
        if (sublog.refunded) {
          return 'Refunded';
        } else if (sublog.free) {
          return 'Free';
        } else if (sublog.paid) {
          return 'Paid';
        } else if (sublog.skip) {
          return 'Skipped';
        }
        return 'Unpaid';
      }

      sublogsObserver() {
        if (this.sublogs) {
          const sublogs = this.sublogs;
          let nonVegEmails = [];
          let nonVegNames = [];
          let vegEmails = [];
          let vegNames = [];
          for (var i = 0; i < sublogs.length; i++) {
            if (sublogs[i].vegetarian_servings > 0) {
              vegEmails.push(sublogs[i].sub_email);
              vegNames.push(sublogs[i].name);
            } else {
              nonVegEmails.push(sublogs[i].sub_email);
              nonVegNames.push(sublogs[i].name);
            }
            sublogs[i].status = this.getStatus(sublogs[i]);
            var fullName = this.slitName(sublogs[i].name);
            sublogs[i].firstName = fullName.first;
            sublogs[i].lastName = fullName.last;
          }
          this.nonVegEmails = nonVegEmails;
          this.nonVegNames = nonVegNames;
          this.vegEmails = vegEmails;
          this.vegNames = vegNames;
        }
      }

      slitName(name) {
        var first = '';
        var last = '';

        var nameArray = name.trim().split(' ');
        if (nameArray.length >= 2) {
          last = nameArray[nameArray.length - 1];
        }
        if (nameArray.length >= 1) {
          first = nameArray[0];
        }
        return {
          first,
          last,
        }
      }

    }

    customElements.define(EmailTable.is, EmailTable);

  </script>
</dom-module>
