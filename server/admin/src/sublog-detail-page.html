<link rel="import"
      href="../../cook/src/shared-styles.html">

<link rel="import"
      href="sublog-sortable-table.html">

<dom-module id="sublog-detail-page">
  <template>
    <shared-styles>
      <style include="shared-styles">
         :host {
          display: block;
          padding: 10px;
        }

        .table-container {
          padding: 12px 0;
        }

        .table-title {
          font-size: 14px;
        }

      </style>
    </shared-styles>

    <h1 class="">[[sublogsByDate.dateString]]</h1>
    <div class="table-container">
      <div class="table-title">
        Unskipped
      </div>
      <sublog-sortable-table id="unskipped"
                             class="table"
                             sublogs="[[sublogsByDate.unskippedSublogs]]">
      </sublog-sortable-table>
      <div class="table-title">
        Skipped
      </div>
      <sublog-sortable-table id="skipped"
                             class="table"
                             sublogs="[[sublogsByDate.skippedSublogs]]">
      </sublog-sortable-table>
    </div>
  </template>

  <script>
    class SublogDetailPage extends Polymer.Element {
      static get is() {
        return 'sublog-detail-page';
      }

      static get properties() {
        return {
          service: {
            type: Object,
          },
          user: {
            type: Object,
            notify: true,
          },
          sublogsByDate: {
            type: Array,
            notify: true,
          },
        }
      }

      static get observers() {
        return [ /* observer descriptors */ ]
      }

      constructor() {
        super();
      }

      connectedCallback() {
        super.connectedCallback();
      }

      selected() {
        const tmp = window.location.pathname.split('/sublogdetail/');
        const dateString = decodeURIComponent(tmp[1]);
        const d = new Date(dateString);
        this.getSubLogsForDate(d);
      }

      getSubLogsForDate(d) {
        this.service.getSubLogsForDate(d, function(slogs, err) {
          if (err.code !== 0) {
            return;
          }
          let sublogDay = {
            date: slogs[0].date,
            dateString: this.getDateString(slogs[0].date),
            sublogs: [],
            skippedSublogs: [],
            unskippedSublogs: [],
          };
          for (let i = 0; i < slogs.length; i++) {
            sublogDay.sublogs.push(slogs[i]);
            if (slogs[i].skip) {
              sublogDay.skippedSublogs.push(slogs[i]);
            } else {
              sublogDay.unskippedSublogs.push(slogs[i]);
            }
          }
          this.sublogsByDate = sublogDay;
        }.bind(this));
      }

      getDateString(dateString) {
        const d = new Date(dateString);
        return d.toUTCString().substring(0, 16);
      }
    }

    customElements.define(SublogDetailPage.is, SublogDetailPage);

  </script>
</dom-module>
