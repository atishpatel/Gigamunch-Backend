[[define "checkout"]]
<!doctype html>
<html lang="en">

<head>
  [[template "head" .]]
  <!-- Load the Client component. -->
  <script src="https://js.braintreegateway.com/web/3.24.1/js/client.min.js"></script>

  <!-- Load the Hosted Fields component. -->
  <script src="https://js.braintreegateway.com/web/3.24.1/js/hosted-fields.min.js"></script>
</head>

<body>
  [[template "theme" .]]
  <style>
    .checkout-wrapper {
      background-color: #f1f3f4;
      padding-bottom: 32px;
    }

    .checkout-wrapper>* {
      margin: auto;
      max-width: 800px;
      background-color: #ffffff;
    }

    body {
      color: #424242;
    }

    .checkout-email-title {
      padding: 8px 0;
    }

    .form-section-title {
      border-bottom: solid #e1e1e1 1px;
      margin: 12px 0;
    }

    .form-section-title>* {
      font-size: 16px;
      margin: 8px 0;
    }

    .form-section-desc {
      color: #797c82;
      font-size: 14px;
    }

    .form-section-note {
      font-size: 14px;
      color: #797c82;
    }

    .content {
      max-width: 1000px;
      margin: auto;
    }

    .bold {
      font-weight: bold;
    }

    .checkout-logo {
      margin-right: auto;
      padding: 24px;
      font-family: 'NexaBold', 'Roboto', sans-serif;
      font-weight: bold;
      font-size: 18px;
      color: white;
      text-shadow: 1px 2px 2px black;
    }

    .header {
      height: 50vh;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: #64656a url('https://storage.googleapis.com/gigamunch-omninexus-website/schedule/whats_next_box_cut.jpg') no-repeat center center;
      background-size: cover;
    }

    .header-title {
      font-size: 35px;
      color: white;
      padding: 12px;
      text-align: center;
    }

    @media (max-width: 700px) {
      .header-title {
        font-size: 26px;
      }
    }

    .checkout-section {
      background-color: #ffffff;
      background-size: cover;
      display: flex;
      flex-direction: row-reverse;
    }

    .checkout-trust {
      font-size: 15px;
      padding: 12px;
      flex: 3;
      border-left: #dedede 1.5px solid;
    }

    .checkout-trust-get,
    .checkout-trust-say {
      padding: 12px 0;
    }

    .checkout-trust-title {
      color: #ff5722;
    }

    .checkout-trust-list {
      margin: 0;
      padding: 0;
      display: block;
    }

    .checkout-trust-list-item {
      margin: 0;
      padding: 8px 0;
      display: flex;
      align-items: center;
    }

    .checkout-trust-list-check {
      margin-right: 8px;
      color: #1f8458;
    }

    .checkout-trust-list-text {}

    .checkout-trust-review {}

    .checkout-trust-review-image {
      padding-bottom: 12px;
    }

    .checkout-trust-review-image img {
      width: 50px;
      border-radius: 50%;
      display: block;
      margin: 0 32px 0 auto;
    }

    .checkout-trust-review p {
      font-style: italic;
    }

    .checkout-trust-security-item {
      display: flex;
      flex-direction: column;
    }

    .checkout-trust-security-image {}

    .checkout-trust-security-image img {
      width: 50px;
      display: block;
      margin: 8px auto 8px 2px;
    }

    .checkout-trust-security-title {
      color: #ff5722;
    }

    .checkout-trust-security-desc {
      font-size: 13px;
    }

    .checkout-form-container {
      padding: 12px;
      flex: 5;
    }

    @media (max-width: 700px) {
      .checkout-section {
        flex-direction: column;
      }
      .checkout-trust {
        flex: 1;
      }
      .checkout-trust-security-item {
        flex-direction: row;
        padding: 8px 0;
      }
      .checkout-trust-security-image img {
        margin: 0 12px 0 12px;
      }
      .checkout-form-container {
        flex: 3;
        border-top: solid #e1e1e1 1px;
      }
    }

    .checkout-row {
      display: flex;
    }

    .checkout-row>* {
      flex: 1;
    }

    .checkout-row>*:not(:first-child) {
      margin-left: 12px;
    }

    .checkout-title-container {
      background: #F06522;
      background: -moz-linear-gradient(45deg, #FF5722, #FFB300);
      background: -webkit-linear-gradient(45deg, #FF5722, #FFB300);
      background: linear-gradient(45deg, #FF5722, #FFB300);
      padding: 16px;
    }

    .checkout-title {
      font-size: 24px;
      margin: 12px 0;
      text-align: center;
      font-style: italic;
      font-weight: 400;
      color: white;
    }

    @media (max-width: 700px) {
      .checkout-title {
        font-size: 20px;
      }
    }

    .checkout-form-container {
      padding: 16px;
    }

    .checkout-form {
      display: flex;
      flex-direction: column;
    }

    .checkout-button {
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      background: #F06522;
      background: -moz-linear-gradient(45deg, #FF5722, #FFB300);
      background: -webkit-linear-gradient(45deg, #FF5722, #FFB300);
      background: linear-gradient(45deg, #FF5722, #FFB300);
      box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
      margin: 12px 0 6px 0;
      /*min-width: 275px;*/
    }

    .checkout-button:disabled {
      background: #dfdfdf;
    }

    .no-commitment {
      margin-top: 12px;
      background-color: #28a971;
      color: white;
      border-radius: 3px;
      padding: 12px;
      display: flex;
      font-size: 14px;
    }

    .no-commitment-checkmark {
      font-size: 64px;
      padding: 0 12px;
      margin: auto;
    }

    .no-commitment-text {
      padding-left: 12px;
    }

    .no-commitment-title {
      border-bottom: solid white 2px;
      font-weight: bold;
      padding: 8px 0;
    }

    .no-commitment-desc {
      padding-top: 8px;
    }

    .checkout-payment-lock {
      color: #1f8458;
    }

    .card-number>i {
      padding: 0 2px;
    }

    .input-container {
      display: flex;
    }

    .hosted-field,
    .input-container>*,
    select {
      margin: 8px 0 12px;
    }

    .input-container>* {
      flex: 1;
    }

    .input-container>*:not(:first-child) {
      flex: 2;
      margin-left: 12px;
    }
    /* Review section */

    .review-order {
      background-color: #fafafa;
      padding: 24px;
      font-size: 14px;
    }

    .item {
      display: flex;
      flex-direction: row;
      padding-bottom: 12px;
    }

    @media (max-width:700px) {
      .item {
        flex-direction: column;
      }
    }

    .item-image>img {
      margin-right: 12px;
      width: 200px;
      border-radius: 3px;
    }

    .item-detail {
      display: flex;
      flex-direction: row;
    }

    .item-title {
      font-weight: 500;
      font-size: 18px;
    }

    .item-desc {
      opacity: .87;
      font-size: 12px;
    }

    .order-summary {
      border-top: solid #d3d3d3 1px;
      padding: 12px 0;
    }

    .order-summary-section {
      padding-top: 8px;
      display: flex;
      flex-direction: row;
    }

    .order-summary-section-name {
      font-weight: 700;
      margin-right: auto;
    }

    .multiplier {
      opacity: .56;
    }

    .old_price {
      opacity: .56;
      text-decoration: line-through;
    }

    @media (max-width: 600px) {}
    /* Selector */

    .select-package-container {
      padding: 24px 0 12px 0;
    }

    .select-package-container ul {
      list-style: none;
      height: 100%;
      width: 100%;
      margin: 0px;
      padding: 0px;
    }

    .select-package-container ul li {
      color: #000000;
      opacity: 0.87;
      display: block;
      position: relative;
      float: left;
    }

    .select-package-container ul li input[type=radio] {
      position: absolute;
      visibility: hidden;
    }

    .select-package-container-button {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      width: 150px;
      height: 115px;
      border: 2px solid #cfd8dc;
      cursor: pointer;
      transition: all 0.15s linear;
      -webkit-transition: all 0.15s linear;
    }

    .select-package-container ul li:first-child .select-package-container-button {
      border-top-left-radius: 6px;
      border-bottom-left-radius: 6px;
      border-right: 0;
    }

    .select-package-container ul li:last-child .select-package-container-button {
      border-top-right-radius: 6px;
      border-bottom-right-radius: 6px;
      border-left: 0;
    }

    .select-package-container-button label {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: row;
      text-align: center;
      width: 100%;
      transition: all 0.15s linear;
      -webkit-transition: all 0.15s linear;
    }

    .most-popular-label {
      font-weight: 300;
      font-size: 12px;
      color: #F44336;
      z-index: 2;
      flex: 3;
    }

    .num-meals-label {
      font-weight: 300;
      font-size: 14px;
      color: rgba(0, 0, 0, 0.87);
      flex: 6;
    }

    .price-per-meal-label {
      font-weight: 300;
      font-size: 12px;
      padding: 0;
      color: rgba(0, 0, 0, 0.54);
      flex: 4;
    }

    ul li:hover .select-package-container-button {
      background-color: rgba(255, 112, 67, 0.1);
    }

    input[type=radio]:checked~.num-meals-label,
    input[type=radio]:checked~.price-per-meal-label,
    input[type=radio]:checked~.most-popular-label {
      color: #ffffff;
      opacity: 1.0;
      background-color: #ff7043;
    }

    @media (max-width: 500px) {
      .select-package-container-button,
      .select-package-container ul li:last-child .select-package-container-button,
      .select-package-container ul li:last-child .select-package-container-button {
        width: 255px;
        border: 2px solid #cfd8dc;
        border-radius: 0px;
      }
    }

    .vegetarian-section {
      padding: 12px 0;
    }

    .vegetarian-label {
      font-weight: 500;
    }

    .terms-and-conditions {
      opacity: .87;
      font-size: 12px;
      padding: 8px 0;
    }

    .address-input-container .apt {
      max-width: 75px;
    }

    .why-free {
      padding: 12px 0;
    }

    .why-free-title {
      color: #28a971;
    }

  </style>

  <script type="text/javascript">
    var nameInputFocusedLogged = false;

    function nameInputFocused() {
      if (!nameInputFocusedLogged) {
        ga('send', 'event', 'schedule_name_tapped', 'focus');
        nameInputFocusedLogged = true;
      }
    }

    var addressInputFocusedLogged = false;

    function addressInputFocused() {
      if (!addressInputFocusedLogged) {
        ga('send', 'event', 'schedule_address_tapped', 'focus');
        addressInputFocusedLogged = true;
      }
    }

    var addressInputSelectedLogged = false;

    function addressInputSelected() {
      if (!addressInputSelectedLogged) {
        ga('send', 'event', 'schedule_address_selected', 'autocomplete');
        addressInputSelectedLogged = true;
      }
    }

    var meal1InputClickLogged = false;

    function meal1InputClick() {
      if (!meal1InputClickLogged) {
        ga('send', 'event', 'schedule_meal_tapped', 'one');
        meal1InputClickLogged = true;
      }
    }

    var meal2InputClickLogged = false;

    function meal2InputClick() {
      if (!meal2InputClickLogged) {
        ga('send', 'event', 'schedule_meal_tapped', 'two');
        meal2InputClickLogged = true;
      }
    }

    var meal4InputClickLogged = false;

    function meal4InputClick() {
      if (!meal4InputClickLogged) {
        ga('send', 'event', 'schedule_meal_tapped', 'four');
        meal4InputClickLogged = true;
      }
    }

    var dayInputClickLogged = false;

    function dayInputClick() {
      if (!dayInputClickLogged) {
        ga('send', 'event', 'schedule_day_tapped', 'click');
        dayInputClickLogged = true;
      }
    }

    var numberInputFocusedLogged = false;

    function numberInputFocused() {
      if (!numberInputFocusedLogged) {
        ga('send', 'event', 'schedule_number_tapped', 'focus');
        numberInputFocusedLogged = true;
      }
    }

    var cvvInputFocusedLogged = false;

    function cvvInputFocused() {
      if (!cvvInputFocusedLogged) {
        ga('send', 'event', 'schedule_cvv_tapped', 'focus');
        cvvInputFocusedLogged = true;
      }
    }

    var expirationDateInputFocusedLogged = false;

    function expirationDateInputFocused() {
      if (!expirationDateInputFocusedLogged) {
        ga('send', 'event', 'schedule_expiration_date_tapped', 'focus');
        expirationDateInputFocusedLogged = true;
      }
    }

    var subscribeClickLogged = false;

    function subscribeClick() {
      if (!subscribeClickLogged) {
        ga('send', 'event', 'schedule_button_tapped', 'click');
        subscribeClickLogged = true;
      }
    }

  </script>
  <div class="checkout-wrapper">
    <div>
      <div class="header">
        <a href="/"
           class="logo checkout-logo">Gigamunch</a>
        <div class="header-title">Where will your next dinner take you?</div>
      </div>

      <div class="checkout-section">
        <div class="checkout-trust">
          <div class="checkout-trust-get">
            <h2 class="checkout-trust-title">What you get</h2>
            <ul class="checkout-trust-list">
              <li class="checkout-trust-list-item">
                <i class="fa fa-check checkout-trust-list-check"
                   aria-hidden="true"></i>
                <div class="checkout-trust-list-text">
                  100% FREE first week
                </div>
              </li>
              <li class="checkout-trust-list-item">
                <i class="fa fa-check checkout-trust-list-check"
                   aria-hidden="true"></i>
                <div class="checkout-trust-list-text">
                  A peek into a new culture every week
                </div>
              </li>
              <li class="checkout-trust-list-item">
                <i class="fa fa-check checkout-trust-list-check"
                   aria-hidden="true"></i>
                <div class="checkout-trust-list-text">
                  A hassle free Monday
                </div>
              </li>
              <li class="checkout-trust-list-item">
                <i class="fa fa-check checkout-trust-list-check"
                   aria-hidden="true"></i>
                <div class="checkout-trust-list-text">
                  Authentic international meals
                </div>
              </li>
              <li class="checkout-trust-list-item">
                <i class="fa fa-check checkout-trust-list-check"
                   aria-hidden="true"></i>
                <div class="checkout-trust-list-text">
                  Cultural guides and music playlists for each country
                </div>
              </li>
            </ul>
          </div>
          <div class="checkout-trust-say">
            <h2 class="checkout-trust-title">What they say</h2>
            <ul class="checkout-trust-list">
              <li class="checkout-trust-list-item">
                <div class="checkout-trust-list-review">
                  <div class="checkout-trust-review">
                    <p>"We got our first meal from Gigamunch last night and LOVED it! Highly recommended!"</p>
                    <div class="checkout-trust-review-image">
                      <img alt="Rachel Woods picture"
                           src="https://storage.googleapis.com/gigamunch-omninexus-website/checkout/rachel_woods.jpg">
                    </div>
                  </div>
                  <div class="checkout-trust-review">
                    <p>"We loved exploring food from various parts of the world."</p>
                    <div class="checkout-trust-review-image">
                      <img alt="Paige Orr Clancy picture"
                           src="https://storage.googleapis.com/gigamunch-omninexus-website/checkout/paige_orr_clancy.jpg">
                    </div>
                  </div>

                  <div class="checkout-trust-review">
                    <p>"Bravo! I love these meals, culture guides, and songs. They are delicious, convenient, educational, and fun."</p>
                    <div class="checkout-trust-review-image">
                      <img alt="Barbara Futter picture"
                           src="https://storage.googleapis.com/gigamunch-omninexus-website/checkout/barbara_futter.jpg">
                    </div>
                  </div>
                </div>
              </li>
            </ul>
          </div>
          <div class="checkout-trust-security">
            <div class="checkout-trust-security-item">
              <div class="checkout-trust-security-image">
                <img src="https://storage.googleapis.com/gigamunch-omninexus-website/checkout/icon-sealygold.png">
              </div>
              <div class="checkout-trust-security-text">
                <div class="checkout-trust-security-title">
                  SKIP OR CANCEL ANYTIME
                </div>
                <p class="checkout-trust-security-desc">
                  If you are out of town or don't want to explore the world with us any longer, skip or cancel anytime.
                </p>
              </div>
            </div>
            <div class="checkout-trust-security-item">
              <div class="checkout-trust-security-image">
                <img src="https://storage.googleapis.com/gigamunch-omninexus-website/checkout/icon-safe.png">
              </div>
              <div class="checkout-trust-security-text">
                <div class="checkout-trust-security-title">
                  YOUR INFORMATION IS SAFE
                </div>
                <p class="checkout-trust-security-desc">
                  We will not sell or rent your personal contact information for any marketing purposes.
                </p>
              </div>
            </div>
            <div class="checkout-trust-security-item">
              <div class="checkout-trust-security-image">
                <img src="https://storage.googleapis.com/gigamunch-omninexus-website/checkout/icon-lock.png">
              </div>
              <div class="checkout-trust-security-text">
                <div class="checkout-trust-security-title">
                  SECURE CHECKOUT
                </div>
                <p class="checkout-trust-security-desc">
                  All information is encrypted and transmitted without risk using a Secure Sockets Layer protocol.
                </p>
              </div>
            </div>
          </div>
        </div>
        <div class="checkout-form-container">
          <form id="checkout-form"
                action="/checkout-thank-you"
                method="post"
                class="checkout-form"
                enctype="application/x-www-form-urlencoded">

            <div class="checkout-row">
              <div>
                <label for="first_name">First Name</label>
                <div class="input-container">
                  <input type="text"
                         name="first_name"
                         id="first_name"
                         onfocus="nameInputFocused()"
                         placeholder="Ms. Excited"
                         size="1"
                         required />
                </div>
              </div>
              <div>
                <label for="last_name">Last Name</label>
                <div class="input-container">
                  <input type="text"
                         name="last_name"
                         id="last_name"
                         size="1"
                         onfocus="nameInputFocused()"
                         required />
                </div>
              </div>
            </div>
            <div class="checkout-row">
              <div class="input-label">
                <label for="name">Email</label>
                <div class="input-container">
                  <input type="text"
                         name="email"
                         id="email"
                         class="checkout-email"
                         placeholder="Email"
                         size="1"
                         value="[[.Email]]" />
                </div>
              </div>
              <div class="input-label">
                <label for="phone_number">Phone Number (for delivery)</label>
                <div class="input-container">
                  <input type="tel"
                         name="phone_number"
                         id="phone_number"
                         size="1"
                         placeholder="615-123-1234" />
                </div>
              </div>
            </div>

            <div>
              <label for="address-input">Address</label>
              <div class="input-container
                       address-input-container">
                <input type="text"
                       name="address-input"
                       id="address-input"
                       onfocus="addressInputFocused()"
                       placeholder="123 Street Name, City"
                       required/>
                <input type="text"
                       name="apt"
                       class="apt"
                       id="apt"
                       placeholder="APT/Unit" />
              </div>
            </div>
            <div>
              <label for="delivery_note">Delivery Notes (optional)</label>
              <div class="input-container">
                <input type="text"
                       name="delivery_notes"
                       id="delivery_notes"
                       placeholder="Gate code: # or any other delivery tips" />
              </div>
            </div>
            <div>

            </div>
            <div>
              <label for="reference">How did you hear about us?</label>
              <div class="input-container">
                <input type="text"
                       name="reference"
                       id="reference"
                       placeholder="My friend Joe Shmoe." />
              </div>
            </div>
            <div class="form-section-title">
              <h2>Choose your bag</h2>
            </div>

            <div class="form-section-desc">
              Every Monday, you will get a bag that will take you on a new journey! How do you want your journey to be?
            </div>
            <br>
            <div class="select-input-group">
              <label>Delivery Day</label>
              <select id="delivery-day"
                      option-value="value"
                      form="checkout-form"
                      onclick="dayInputClick()">
                    <option selected value="Monday">Monday</option>
                  </select>
            </div>
            <div class="form-section-note">*Deliveries are only offered on Monday nights for now.</div>
            <div id="meal-selector"
                 class="select-package-container">
              <ul>
                <li>
                  <div class="select-package-container-button"
                       for="meal-option-2">
                    <input type="radio"
                           id="meal-option-2"
                           value="2"
                           name="servings"
                           onclick="meal2InputClick()"
                           checked>
                    <label class="most-popular-label"
                           for="meal-option-2">*Most Popular!*</label>
                    <label class="num-meals-label"
                           for="meal-option-2">2 MEAL BAG</label>
                    <label class="price-per-meal-label"
                           for="meal-option-2">$16 PER MEAL</label>
                  </div>
                </li>

                <li>
                  <div class="select-package-container-button"
                       for="meal-option-3">
                    <input type="radio"
                           id="meal-option-3"
                           value="4"
                           onclick="meal4InputClick()"
                           name="servings">
                    <label class="most-popular-label"
                           for="meal-option-3"> </label>
                    <label class="num-meals-label"
                           for="meal-option-3">4 MEAL BAG</label>
                    <label class="price-per-meal-label"
                           for="meal-option-3">$15 PER MEAL</label>
                  </div>
                </li>
              </ul>
            </div>
            <div class="vegetarian-section checkbox-group">
              <div class="checkbox">
                <input type="checkbox"
                       value="None"
                       id="vegetarian"
                       name="vegetarian" />
                <label for="vegetarian"></label>
              </div>
              <label class="vegetarian-label checkbox-label">I'm a vegetarian! ðŸŒ±</label>
            </div>

            <div id="why-free"
                 class="why-free">
              <div class="form-section-title">
                <h2 class="why-free-title">Why Free Meal?</h2>
              </div>
              <p class="form-section-desc">We believe in trying before buying. We're so confident you'll love it; we're willing to take the risk.</p>
            </div>

            <div class="no-commitment">
              <div class="no-commitment-checkmark"><i class="fa
                       fa-check"
                   aria-hidden="true"></i></div>
              <div class="no-commitment-text">
                <div class="no-commitment-title">No commitment. No, really.</div>
                <div class="no-commitment-desc">Your first bag is on us because we know you'll love it! If you don't want to continue, you'll have 4 days after your first meal to cancel without getting charged a dime.</div>
              </div>
            </div>
            <div class="form-section-title">
              <h2>Payment Info <i class="fa fa-lock checkout-payment-lock" aria-hidden="true"></i></h2>
            </div>
            <div>
              <label for="card-number"
                     class="card-number">Card Number <i class="fa fa-cc-visa" aria-hidden="true"></i>
                     <i class="fa fa-cc-mastercard" aria-hidden="true"></i>
                     <i class="fa fa-cc-discover" aria-hidden="true"></i></label>
              <div class="hosted-field"
                   id="card-number"></div>
            </div>
            <div>
              <label for="cvv">CVV</label>
              <div class="hosted-field"
                   id="cvv"></div>

              <label for="expiration-date">Expiration Date</label>
              <div class="hosted-field"
                   id="expiration-date"></div>
            </div>
            <div class="review-order">
              <div class="form-section-title">
                <h2>Order Summary</h2>
              </div>
              <div class="item">
                <div class="item-image">
                  <img src="https://storage.googleapis.com/gigamunch-omninexus-website/schedule/final_box.jpg"
                       alt="A bag with an international meal.">
                </div>
                <div class="item-detail">
                  <div class="item-text">
                    <div class="item-title"><span id="boxForTitle">Bag for Two</span></div>
                    <div class="item-desc">
                      Today's total: FREE! Your first bill will be on <span id="first_date">__first_date__</span>. Then, a recurring fee of $<span id="total"></span> (+ tax) will charged every week. Skip a week or cancel your subscription anytime with
                      a 4 day notice.
                    </div>
                  </div>
                </div>
              </div>
              <div class="order-summary">
                <div class="order-summary-section">
                  <div class="order-summary-section-name">Meals <span id="meal_multiplier"
                          class="multiplier">x2</span></div>
                  <div class="order-summary-section-price"><span class="old_price">$<span id="box_total"></span></span> FREE</div>
                </div>
                <div class="order-summary-section">
                  <div class="order-summary-section-name">Delivery</div>
                  <div class="order-summary-section-price">FREE</div>
                </div>
                <div class="order-summary-section">
                  <div class="order-summary-section-name">Tax</div>
                  <div class="order-summary-section-price"><span class="old_price">$<span id="tax_total"></span></span> FREE</div>
                </div>
                <div class="order-summary-section">
                  <div class="order-summary-section-name">Total</div>
                  <div class="order-summary-section-price">$0.00</div>
                </div>
              </div>
            </div>
            <input type="hidden"
                   name="payment_method_nonce">
            <div class="terms-and-conditions">By subscribing, I agree to the <a href="/terms"
                 target="_blank">Terms &amp; Conditions</a> and <a href="/privacy"
                 target="_blank">Privacy Policy</a>.</div>
            <input id="submit-button"
                   class="checkout-button"
                   type="submit"
                   value="Subscribe"
                   onclick="subscribeClick()"
                   disabled/>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    function logError(desc) {
      ga('send', 'event', 'schedule_checkout_error', desc);
      ga('send', 'exception', {
        exDescription: desc,
        exFatal: false,
      });
    }

    function logRespError(err) {
      var desc = 'Function: startsubscription | Message: ' + err.message + '| Details: ' + err.detail;
      logError(desc);
    }


    var autocomplete;
    var address = {
      apt: ''
    };
    // Google Maps Autocomplete
    function initMap() {
      var addressInput = document.getElementById('address-input');
      autocomplete = new this.google.maps.places.Autocomplete(addressInput, {
        types: ['address']
      });

      autocomplete.addListener('place_changed', function() {
        var componentForm = {
          street_number: 'short_name',
          route: 'long_name',
          locality: 'long_name',
          administrative_area_level_1: 'short_name',
          country: 'long_name',
          postal_code: 'short_name'
        };
        // Get the place details from the autocomplete object.
        var place = autocomplete.getPlace();

        for (var component in componentForm) {
          // document.getElementById(component).value = '';
        }
        var addr = {};
        // Get each component of the address from the place details
        // and fill the corresponding field on the form.
        for (var i = 0; i < place.address_components.length; i++) {
          var addressType = place.address_components[i].types[0];
          if (componentForm[addressType]) {
            var val = place.address_components[i][componentForm[addressType]];
            addr[addressType] = val;
          }
        }
        var apt = '';
        if (address && address.apt) {
          apt = address.apt.toUpperCase();
        }
        var streetNumber = '';
        if (addr['street_number']) {
          streetNumber = addr['street_number'];
        }
        var street = streetNumber + ' ' + addr['route'];
        var city = addr['locality'];
        var state = addr['administrative_area_level_1'];
        var country = addr['country'];
        var zip = addr['postal_code'];
        var latitude = place.geometry.location.lat();
        var longitude = place.geometry.location.lng();
        address = {
          apt: apt,
          street: street,
          city: city,
          state: state,
          zip: zip,
          country: country,
          latitude: latitude,
          longitude: longitude,
        };
        addressInputSelected()
      });
    }

    // BrainTree 
    var authorization = 'production_fzp6pdxg_wsgmypp8c46cnbpc';
    if (!APP.IsProd) {
      authorization = 'sandbox_vprqjq87_4j6rdqcz74z7rt92';
    }
    var submit = document.querySelector('input[type="submit"]');
    var form = document.querySelector('#checkout-form');
    var hostedFieldsInst;
    var btClientInst;
    braintree.client.create({
      authorization: authorization
    }, function(clientErr, clientInstance) {
      if (clientErr) {
        // Handle error in client creation
        console.error('Error with client creation', clientErr);
        return;
      }
      byClientInst = clientInstance;
      braintree.hostedFields.create({
        client: clientInstance,
        styles: {
          'input': {
            'font-size': '14px',
            'outline': 'none'
          },
          '.invalid': {
            'color': 'red'
          },
          '.valid': {
            'color': 'green'
          }
        },
        fields: {
          number: {
            selector: '#card-number',
            placeholder: '4111 1111 1111 1111'
          },
          cvv: {
            selector: '#cvv',
            placeholder: '123'
          },
          expirationDate: {
            selector: '#expiration-date',
            placeholder: '10/2021'
          }
        }
      }, function(hostedFieldsErr, hostedFieldsInstance) {
        if (hostedFieldsErr) {
          // Handle error in Hosted Fields creation
          console.error('Error with hosted fields creation', hostedFieldsErr);
          return;
        }
        hostedFieldsInst = hostedFieldsInstance;
        submit.removeAttribute('disabled');
        form.addEventListener('submit', function(event) {
          event.preventDefault();
          if (!validateFields()) {
            return
          }
          submit.setAttribute('disabled', true);
          hostedFieldsInstance.tokenize({}, function(tokenizeErr, payload) {
            if (tokenizeErr) {
              // Handle error in Hosted Fields tokenization
              console.error('failed to tokenize fields', tokenizeErr)
              logError(JSON.stringify(tokenizeErr));
              if (tokenizeErr.type === 'CUSTOMER') {
                alert('Invalid credit card information.');
              } else {
                alert('An unknown error occured while verifying your credit card. Please try a different card or contact enis@gigamunchapp.com.');
              }
              submit.removeAttribute('disabled');
              return;
            }

            // Put `payload.nonce` into the `payment_method_nonce` input, and then
            // submit the form. Alternatively, you could send the nonce to your server
            // with AJAX.
            document.querySelector('input[name="payment_method_nonce"]').value = payload.nonce;

            // submit form 
            var firstName = form.elements['first_name'].value;
            var lastName = form.elements['last_name'].value;
            var email = form.elements['email'].value;
            var deliveryNotes = form.elements['delivery_notes'].value;
            var reference = form.elements['reference'].value;
            var phoneNumber = form.elements['phone_number'].value;
            var paymentNonce = payload.nonce;
            // get value of checked radio button
            var servings;
            var radios = form.elements['servings'];
            for (var i = 0, len = radios.length; i < len; i++) {
              if (radios[i].checked) { // radio checked?
                servings = radios[i].value; // if so, hold its value in servings
                break;
              }
            }
            // check if servings should be vegetarian
            var vegetarian = form.elements['vegetarian'].checked;
            if (vegetarian) {
              var vegServings = servings;
              servings = "0";
            }
            var aptEl = document.getElementById('apt');
            address.apt = aptEl.value;
            if (!address.street) {
              address.full_address = document.getElementById('address-input').value;
            }
            var req = {
              'email': email,
              'address': address,
              'delivery_notes': deliveryNotes,
              'first_name': firstName,
              'last_name': lastName,
              'payment_method_nonce': paymentNonce,
              'servings': servings,
              'vegetarian_servings': vegServings,
              'reference': reference,
              'phone_number': phoneNumber,
            };

            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/api/v1/SubmitCheckout', true);
            xhr.setRequestHeader("Content-type", "application/json");
            xhr.onload = function() {
              try {
                submit.removeAttribute('disabled');
                var resp = JSON.parse(this.response);
                if (resp.error && resp.error.code === 400) {
                  alert(resp.error.message);
                  console.log(resp.error);
                  logRespError(resp.error);
                  return;
                }
                if (resp.error && resp.error.code !== 200) {
                  alert('Woops something went wrong: ', resp.error.message);
                  console.error(resp.error);
                  logRespError(resp.error)
                  return;
                }
                if (req.email) {
                  window.location = '/checkout-thank-you?email=' + encodeURIComponent(req.email);
                } else {
                  window.location = '/checkout-thank-you';
                }
              } catch (err) {
                var fullError = err;
                try {
                  fullError = 'resp: ' + JSON.stringify(resp) + 'err: ' + err;
                } catch (e) {}
                console.error(fullError);
                logError(fullError);
              }
            };
            xhr.send(JSON.stringify(req));
          });
        }, false);
        // add listeners to log events 
        hostedFieldsInstance.on('focus', function(e) {
          switch (e.emittedBy) {
            case 'number':
              numberInputFocused()
              break;
            case 'cvv':
              cvvInputFocused()
              break;
            case 'expirationDate':
              expirationDateInputFocused()
              break;
          }
        })
      });

    });

    function validateFields() {
      return true
    }

    function updateOrderInfo() {
      var d = new Date();
      // d.setDate(d.getDate() + 2);
      d.setTime(d.getTime() + 72 * 3600 * 1000); // add 72 hours
      while (d.getDay() !== 1) { // while not Monday
        d.setDate(d.getDate() + 1);
      }
      // TODO remove after Aug 21, 2017
      if (d.getMonth() === 7 && d.getDay() === 21) {
        d.setDate(d.getDate() + 7)
      }
      d.setDate(d.getDate() + 4);
      var date = d.getDate();
      document.getElementById('first_date').innerHTML = d.toLocaleDateString();
      var oneBoxPrice = 0.0;
      var servingsPerBox = 0;

      // get value of checked radio button
      var val;
      var radios = form.elements['servings'];
      for (var i = 0, len = radios.length; i < len; i++) {
        if (radios[i].checked) { // radio checked?
          val = radios[i].value; // if so, hold its value in val
          break; // and break out of for loop
        }
      }
      var boxForTitleText;
      var taxTotal;
      switch (val) {
        case '1':
          oneBoxPrice = 17;
          servingsPerBox = 1;
          boxForTitleText = 'Bag for One';
          break;
        case '2':
          oneBoxPrice = 16;
          servingsPerBox = 2;
          boxForTitleText = 'Bag for Two';
          taxTotal = 3.12;
          break;
        case '4':
          oneBoxPrice = 15;
          servingsPerBox = 4;
          boxForTitleText = 'Bag for Four';
          taxTotal = 5.85;
          break;
      }
      var boxTotal = oneBoxPrice * servingsPerBox;
      // var total = boxTotal + deliveryTotal + taxTotal;
      var total = boxTotal;

      document.getElementById('meal_multiplier').innerHTML = 'x' + servingsPerBox;
      document.getElementById('boxForTitle').innerHTML = boxForTitleText;
      document.getElementById('box_total').innerHTML = boxTotal.toFixed(0);
      document.getElementById('tax_total').innerHTML = taxTotal.toFixed(2);
      document.getElementById('total').innerHTML = total.toFixed(2);
    }

    document.getElementById('meal-option-2').addEventListener('change', updateOrderInfo);
    document.getElementById('meal-option-3').addEventListener('change', updateOrderInfo);

    updateOrderInfo();

    function getQueryParameter(name, url) {
      if (!url) url = location.href;
      name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
      var regexS = "[\\?&]" + name + "=([^&#]*)";
      var regex = new RegExp(regexS);
      var results = regex.exec(url);
      return results == null ? null : results[1];
    }
    var promo = getQueryParameter('promo', location.href);
    if (promo && (promo === 'quizfree')) {
      var submitButton = document.querySelector('#submit-button');
      submitButton.value = 'Get Free Dinner';
      var mealSelector = document.querySelector('#meal-selector');
      mealSelector.style.display = 'none';

    }

  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCDOw6QXpThS7dm3rl79wDdEvwPlLWsi0Y&libraries=places&callback=initMap"
          async
          defer></script>
  [[template "footer" .]]
</body>

</html>
[[end]]
