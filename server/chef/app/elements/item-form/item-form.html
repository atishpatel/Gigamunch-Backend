<!--

-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-form/iron-form.html">

<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html">

<link rel="import" href="../paper-file-input/paper-file-input.html">

<dom-module id="item-form">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }

      #submitButton {
        width: 100%;
      }
    </style>
    <form is="iron-form"
          id="form"
          method="post"
          action="#"
          on-change="_updateSubmitButtonState"
          on-iron-form-presubmit="_saveItem">
      <paper-file-input photos="{{item.photos}}"
                        action="/upload"
                        ></paper-file-input>
      <paper-input label="Title"
                   value="{{item.title}}"
                   required
                   auto-validate></paper-input>
      <paper-input label="Description"
                   value="{{item.description}}"
                   required
                   auto-validate></paper-input>
      <paper-input label="Ingredients"
                   placeholder="tomatos,onions,..."
                   value="{{_ingredients}}"
                   required
                   auto-validate></paper-input>
      <paper-input label="General Tags"
                   value="{{_general_tags}}"
                   required
                   auto-validate></paper-input>
      <!-- TODO: switch to a checklist for dietary needs -->
      <paper-input label="Dietary Needs Tags"
                   placeholder="vegetarian,no-nuts,..."
                   value="{{_dietary_needs_tags}}"
                   auto-validate></paper-input>
      <paper-button id="submitButton"
                   on-tap="_submit"
                   raised
                   disabled>
        <paper-spinner id="spinner" hidden></paper-spinner>Submit
      </paper-button>
    </form>
  </template>
  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'item-form',

        properties: {
          item: {
            type: Object,
            notify: true,
            reflectToAttribute: true,
            value: {}
          },
          _token: {
            type: String,
            notify:true
          },
          _ingredients: {
            type: String,
            observer: '_updateIngredients'
          },
          _general_tags: {
            type: String,
            observer: '_updateGeneralTags'
          },
          _dietary_needs_tags: {
            type: String,
            observer: '_updateDietaryNeedsTags'
          }
        },
        saved: function() {
          this.$.spinner.hidden = true;
          this.$.spinner.active = false;
        },
        _saveItem: function(event) {
          if (event !== undefined || event !== null) {
            event.preventDefault();
          }
          this.$.spinner.hidden = false;
          this.$.spinner.active = true;
          this.$.submitButton.disabled = true;
          this.fire('save')
        },
        _submit: function() {
          this.$.form.submit();
        },
        _updateIngredients: function(ing) {
          this.item.ingredients = ing.split(',');
        },
        _updateGeneralTags: function(gt) {
          this.item.general_tags = gt.split(',');
        },
        _updateDietaryNeedsTags: function(dnt) {
          this.item.dietary_needs_tags = dnt.split(',');
        },
        _updateSubmitButtonState: function() {
          var form = this.$.form;
          var submitButton = this.$.submitButton;
          // Validate the entire form to see if we should enable the `Submit` button.
          submitButton.disabled = !form.validate();
        }
      });
    })();
  </script>
</dom-module>
