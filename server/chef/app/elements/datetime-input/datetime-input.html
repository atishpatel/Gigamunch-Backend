<!--

-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">


<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-time-picker/paper-time-picker.html">
<link rel="import" href="../../bower_components/iron-icons/editor-icons.html">
<link rel="import" href="../../bower_components/iron-icons/device-icons.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">

<link rel="import" href="../d-calendar/d-calendar.html">

<dom-module id="datetime-input">
  <template>
    <style include="iron-flex iron-flex-alignment paper-time-picker-dialog-style">
      :host {
        display: block;
        padding-top: 10px;

        --paper-button: {
          background: white;
          color: var(--primary-color);
        }
      }
      .divider {
        flex: .05;
      }
      d-calendar {
        padding: 0px;
      }
      label {
        font-size: 12px;
        color: #727272;
      }
      paper-input {
        margin-top: -20px;
      }

    </style>
    <label>[[label]]</label>
    <div class="layout horizontal">
      <paper-input class="flex" id="dateInput" on-tap="_showDatePicker" value="[[_date]]">
        <iron-icon icon="editor:insert-invitation" suffix></iron-icon>
      </paper-input>
      <span class="divider">
      </span>
      <paper-input id="timeInput" class="flex" on-tap="_showTimePicker" value="{{_time}}">
        <iron-icon icon="device:access-time" suffix></iron-icon>
      </paper-input>
    </div>


    <paper-dialog id="datePickerDialog" modal
      on-iron-overlay-closed="_dismissDateDialog">
      <d-calendar id="datePicker" class="light-theme" selected-date="{{_d}}"></d-calendar>
      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm>OK</paper-button>
      </div>
    </paper-dialog>

    <paper-dialog id="timePickerDialog" modal
                  class="paper-time-picker-dialog"
                  on-iron-overlay-closed="_dismissTimeDialog">
      <paper-time-picker id="timePicker" time="{{_time}}"></paper-time-picker>
      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm>OK</paper-button>
      </div>
    </paper-dialog>

  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'datetime-input',

      properties: {
        epoch: {
          type: Number,
          notify: true,
          reflectToAttribute: true,
          value: (new Date()).getTime(),
          observer: '_updateEpoch'
        },
        label: {
          type: String,
          notify: true,
          value: 'Pick a date'
        },
        _date: {
          type: String,
          notify: true
        },
        _d: {
          type: Object
        },
        _time: {
          type: String,
          notify: true
        }
      },
      _updateEpoch: function(epochTime) {
        console.log('epochTime', epochTime);
        var epochDate = new Date(epochTime);
        this.epoch = epochTime;
        this._date = epochDate.toLocaleDateString();
        this._d = epochDate;
        this._time = epochDate.toLocaleTimeString().replace(/:[0-9][0-9]/,'');

      },
      _dismissTimeDialog: function(e) {
        if (e.detail.confirmed) {
          this._time = this.$.timePicker.time;
          this.epoch = new Date(this._date + ' ' + this._time).getTime();
        }
      },
      _dismissDateDialog: function(e) {
        if (e.detail.confirmed) { // pressed ok
          this._date = new Date(this._d).toLocaleDateString();
          this.epoch = new Date(this._date + ' ' + this._time).getTime();
        } else { // pressed cancel
          this._d = new Date(this._date);
        }
      },
      _showTimePicker: function() {
        this.$.timePickerDialog.toggle();
      },
      _showDatePicker: function() {
        this.$.datePickerDialog.toggle();
      }
    });
  })();
  </script>
</dom-module>
