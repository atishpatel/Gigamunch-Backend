"use strict";function GetToken(){for(var e=document.cookie.split(";"),t=0;t<e.length;t++){for(var n=e[t];" "===n.charAt(0);)n=n.substring(1);if(0===n.indexOf("AUTHTKN="))return n.substring("AUTHTKN=".length,n.length)}if("localhost"===location.hostname){var r=window.localStorage.getItem("AUTHTKN");return r||""}return""}function SetToken(e){var t=GetJWT(e),n=new Date(0);t&&n.setUTCSeconds(t.exp),document.cookie="AUTHTKN="+e+"; expires="+n.toUTCString()+"; path=/","localhost"===location.hostname&&window.localStorage.setItem("AUTHTKN",e)}function GetJWT(e){if(!e)return null;var t=e.replace(/[+\/]/g,function(e){return"+"===e?"-":"_"}).replace(/=/g,"").split(".")[1].replace(/\s/g,"");return JSON.parse(window.atob(t.replace(/[-_]/g,function(e){return"-"===e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,"")))}function IsLoggedIn(){return""!==GetToken()}addEventListener("UserUpdated",UpdateUser);var ID="",Email="",FirstName="",LastName="",PhotoURL="";function UpdateUser(){var e=GetToken();if(e){var t=GetJWT(e);t&&(ID=t.id,Email=t.email,FirstName=t.first_name,LastName=t.last_name,PhotoURL=t.photo_url)}}function IsAdmin(){var e=GetJWT(GetToken());return!!e&&getKthBit(e.perm,2)}function HasCreditCard(){var e=GetJWT(GetToken());return!!e&&getKthBit(e.perm,0)}function getKthBit(e,t){return 1==(e>>t&1)}UpdateUser();var user=Object.freeze({IsLoggedIn:IsLoggedIn,get ID(){return ID},get Email(){return Email},get FirstName(){return FirstName},get LastName(){return LastName},get PhotoURL(){return PhotoURL},UpdateUser:UpdateUser,IsAdmin:IsAdmin,HasCreditCard:HasCreditCard});function Login(e){return callFetch("/api/v1/Login","POST",{token:e}).then(function(e){return e&&e.token&&SetToken(e.token),e})}function callFetch(e,t,n){return fetch(e,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(e){return e.json()}).catch(function(e){console.error("failed to callFetch",e),console.error("details: ",e.code,e.name,e.message,e.detail)})}var service=Object.freeze({Login:Login});APP.Service=service,APP.User=user,console.log("app.js loaded");