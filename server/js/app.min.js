function GetURLParmas(){var e={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(n,t,i){return e[t]=i,i}),e}var utils=Object.freeze({GetURLParmas:GetURLParmas});function SetToken(e){var n=GetJWT(e),t=new Date(0);n&&t.setUTCSeconds(n.exp),document.cookie="AUTHTKN="+e+"; expires="+t.toUTCString()+"; path=/","localhost"===location.hostname&&window.localStorage.setItem("AUTHTKN",e)}function GetJWT(e){if(!e)return null;var n=e.replace(/[+\/]/g,function(e){return"+"===e?"-":"_"}).replace(/=/g,"").split(".")[1].replace(/\s/g,"");return JSON.parse(window.atob(n.replace(/[-_]/g,function(e){return"-"===e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,"")))}function Login(e){return callFetch("/api/v1/Login","POST",{token:e}).then(function(e){return e&&e.token&&SetToken(e.token),e})}function callFetch(e,n,t){return fetch(e,{method:n,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(e){return e.json()}).catch(function(e){console.error("failed to callFetch",e)})}var service=Object.freeze({Login:Login});function SignOut(e){firebase.auth().signOut().then(e)}function SetupFirebase(){var e;e=APP.IsProd?{apiKey:"AIzaSyC-1vqT4YIKXVmrGkaoVSj1BJnm48NxlT0",authDomain:"gigamunch-omninexus.firebaseapp.com",databaseURL:"https://gigamunch-omninexus.firebaseio.com",projectId:"gigamunch-omninexus",storageBucket:"gigamunch-omninexus.appspot.com",messagingSenderId:"837147123677"}:{apiKey:"AIzaSyBHPe4B4k72ljnBXszda6AJGGg21YqEJ4g",authDomain:"gigamunch-omninexus-dev.firebaseapp.com",databaseURL:"https://gigamunch-omninexus-dev.firebaseio.com",projectId:"gigamunch-omninexus-dev",storageBucket:"gigamunch-omninexus-dev.appspot.com",messagingSenderId:"108585202286"},firebase.initializeApp(e)}function SetupFirebaseAuthUI(e){var n={tosUrl:"/terms",privacyPolicyUrl:"/privacy",signInSuccessUrl:"/sub/",signInOptions:[{provider:firebase.auth.EmailAuthProvider.PROVIDER_ID,requireDisplayName:!1}],credentialHelper:firebaseui.auth.CredentialHelper.NONE};new firebaseui.auth.AuthUI(firebase.auth()).start(e,n)}var Events={SignedOut:"signed-out",SignedIn:"signed-in"};SetupFirebase(),firebase.auth().onAuthStateChanged(function(e){var n;if(console.log("user",e),e){n=Events.SignedIn,e.getIdToken(!1).then(function(e){Login(e)}),APP.User=e;var t=document.createEvent("Event");t.initEvent(n,!0,!0),window.dispatchEvent(t)}else n=Events.SignedOut});var auth=Object.freeze({SignOut:SignOut,SetupFirebase:SetupFirebase,SetupFirebaseAuthUI:SetupFirebaseAuthUI,Events:Events});APP.Utils=utils,APP.Service=service,APP.Auth=auth,console.log("app.js loaded");