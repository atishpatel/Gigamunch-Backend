service: sub
runtime: go
api_version: go1

handlers:
  - url: /sub/api/.*
    script: _go_app
    secure: always

  - url: /sub/swagger.json
    static_files: app/SubAPI.swagger.json
    upload: app/SubAPI.swagger.json
    secure: always
  
  - url: /sub/css
    static_dir: app/dist/css
    secure: always

  - url: /sub/js
    static_dir: app/dist/js
    secure: always

  - url: /sub/(.*\.(js|json))$
    static_files: app/dist/\1
    upload: app/dist/.*\.(js|json)$

  - url: /sub/manifest.json
    static_dir: app/dist/manifest.json
    secure: always

  # TODO: set meta data on server side
  - url: /sub.*
    static_files: app/dist/index.html
    upload: app/dist/index.html
    secure: always

  - url: /.*
    script: _go_app

env_variables:
  MYSQL_CONNECTION: server:gigamunch@cloudsql(PROJECTID:us-central1:gigasqldb)/gigamunch?collation=utf8mb4_general_ci
  PROJECT_ID: PROJECTID

skip_files:
  - ^(.*/)?.*/test/.*$
  - ^(.*/)?.*/tests/.*$
  - ^(.*/)?.*\.DS_Store$
  - ^(.*/)?.*\.md$
  - ^(.*/)?.*\.yml$
  - ^(.*/)?.*\.gitignore$
  - ^(.*/)?.*\.lock$
  - ^(.*/)?.*/LICENSE$
  - ^(app/node_modules/.*)
