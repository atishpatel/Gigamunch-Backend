<link rel="import"
      href="../bower_components/polymer/polymer-element.html">
<link rel="import"
      href="../bower_components/paper-button/paper-button.html">
<link rel="import"
      href="../bower_components/paper-spinner/paper-spinner.html">

<link rel="import"
      href="shared-styles.html">
<link rel="import"
      href="materialize-styles.html">

<dom-module id="executions-page">
  <template>
    <materialize-styles>
      <style include="materialize-styles"></style>
    </materialize-styles>
    <shared-styles>
      <style include="shared-styles">
        :host {
          display: block;
          padding: 10px;
        }

        .executions-table {
          padding: 10px;
        }

        .btn:link,
        .btn:visited {
          color: white;
        }

      </style>
    </shared-styles>

    <div>
      <h1 class="page-title">Culture Execution</h1>
      <paper-spinner hidden$="[[!loading]]"
                     active="[[loading]]">
      </paper-spinner>

      <a href="execution"  class="waves-effect btn">Create new</a>

      <table class="striped executions-table">
        <thead>

          <tr>
            <th>Published</th>
            <th>Date</th>
            <th>City, Country</th>
            <th>Culture Cook</th>
          </tr>
        </thead>
        <tbody>
          <template is="dom-repeat"
                    items="[[executions]]"
                    as="execution">
            <tr>
              <td>
                <i class="material-icons"
                   style="font-size: 42px;">[[execution.icon]]</i>
              </td>
              <td><a href="execution/[[execution.id]]">[[execution.date]]</a></td>
              <td>[[execution.culture.flag_emoji]] [[execution.culture.city]], [[execution.culture.country]]</td>
              <td>[[execution.culture_cook.first_name]] [[execution.culture_cook.last_name]]</td>
            </tr>
          </template>
        </tbody>
      </table>

  </template>
  </dom-repeat>
  </div>
  </template>

  <script>
    class ExecutionsPage extends Polymer.Element {
      static get is() {
        return 'executions-page';
      }

      static get properties() {
        return {
          service: {
            type: Object,
          },
          executions: {
            type: Array,
            notify: true,
          },
          loading: {
            type: Boolean
          }
        }
      }

      static get observers() {
        return [ /* observer descriptors */ ]
      }

      selected() {
        this.getExecutions();
      }

      getExecutions() {
        this.service.GetExecutions(0, 1000).then((resp) => {
          let err = resp.error;
          if (err && err.code !== 0) {
            return;
          }
          let executions = resp.executions;
          for (let i = 0; i < executions.length; i++) {
            if (executions[i].publish) {
              executions[i].icon = 'public';
            } else {
              executions[i].icon = 'short_text';
            }
          }

          this.executions = executions;
        });
      }
    }
    window.customElements.define(ExecutionsPage.is, ExecutionsPage);

  </script>
</dom-module>
